import{a as _,u as A,r,j as e,m as y}from"./index-DGNH6TTz.js";import{h as j,q as T,c as Y,d as w,w as N,g as q,i as M,j as G,f as O,b as W}from"./firebase-DP6Zpsn6.js";const z=a=>new Promise((i,l)=>{const o=new FileReader;o.readAsDataURL(a),o.onload=()=>i(o.result.split(",")[1]),o.onerror=u=>l(u)}),H=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}),e.jsx("path",{d:"M12 12v9"}),e.jsx("path",{d:"m16 16-4-4-4 4"})]}),J=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),e.jsx("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})]});function $(){const{showNotification:a}=_(),i=A(),[l,o]=r.useState(j.currentUser),[u,v]=r.useState(!0),[h,x]=r.useState(!1),[b,S]=r.useState(""),[m,g]=r.useState({name:"",email:"",phone:"",college:""}),[n,P]=r.useState(null),[p,C]=r.useState(0),I=3999,k=2999,D=10;r.useEffect(()=>j.onAuthStateChanged(s=>{s?(o(s),g(c=>{var d;return{...c,phone:((d=s.phoneNumber)==null?void 0:d.replace("+91",""))||""}})):(localStorage.setItem("intendedPath","/register-bundle"),i("/student-login"))}),[i]),r.useEffect(()=>{l&&(async()=>{try{const s=T(Y(w,"registrations"),N("courseId","==","bundle"),N("confirmed","==",!0)),d=(await q(s)).size;C(d<D?k:I)}catch(s){console.error("Error fetching bundle data:",s),S("Failed to load registration details. Please try again.")}finally{v(!1)}})()},[l]);const E=t=>{navigator.clipboard.writeText(t).then(()=>{a("UPI ID copied to clipboard!","success")},()=>{a("Failed to copy UPI ID.","error")})},U=t=>g({...m,[t.target.name]:t.target.value}),B=t=>P(t.target.files[0]),L=async t=>{if(t.preventDefault(),!n){a("Please upload a screenshot of your payment.","error");return}x(!0);try{const s=M(G,"uploadScreenshot"),c=await z(n),f=(await s({file:c,fileName:n.name,contentType:n.type})).data.downloadURL;if(!f)throw new Error("Cloud function did not return a URL.");const F=`${l.uid}_bundle`,R={userId:l.uid,courseId:"bundle",...m,screenshotUrl:f,priceOffered:p,amountPaid:p,paymentStatus:"full_payment_pending",confirmed:!1,registeredAt:new Date};await O(W(w,"registrations",F),R),i("/confirmation")}catch(s){console.error("Error submitting form:",s),a("There was an error submitting your registration.","error")}finally{x(!1)}};return u?e.jsx("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center text-white text-lg animate-pulse",children:"Calculating your special bundle price..."}):b?e.jsx("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center text-red-500 font-semibold text-lg",children:b}):e.jsx("div",{className:"bg-slate-900 text-white min-h-screen font-sans pt-24 pb-12 md:pt-32 md:pb-20",children:e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-3xl mx-auto px-4",children:e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 p-6 md:p-8 rounded-2xl shadow-2xl shadow-purple-900/20",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-indigo-400",children:"Register for Combined Bundle"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"You're one step away from unlocking all courses!"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4 border-b-2 border-slate-700 pb-2",children:"Step 1: Complete Payment"}),e.jsxs("div",{className:"mt-4 text-center bg-slate-900 p-6 rounded-lg",children:[e.jsx("h3",{className:"font-bold text-lg text-purple-300",children:"Final Price to Pay"}),e.jsxs("p",{className:"text-white font-bold text-5xl my-2",children:["â‚¹",p]}),e.jsx("p",{className:"font-semibold text-slate-400 mt-4",children:"Pay using UPI to the ID below:"}),e.jsxs("div",{className:"flex items-center justify-center bg-slate-700/50 p-2 rounded-md mt-2 max-w-xs mx-auto",children:[e.jsx("p",{className:"font-mono text-purple-300 tracking-wider",children:"your-upi-id@okhdfcbank"}),e.jsx("button",{onClick:()=>E("your-upi-id@okhdfcbank"),className:"ml-3 text-slate-400 hover:text-white transition",children:e.jsx(J,{})})]})]})]}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b-2 border-slate-700 pb-2",children:"Step 2: Fill Your Details"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[{id:"name",label:"Full Name",type:"text",placeholder:"Your Name"},{id:"email",label:"Email Address",type:"email",placeholder:"you@example.com"},{id:"phone",label:"Phone Number",type:"tel",disabled:!0},{id:"college",label:"College Name",type:"text",placeholder:"Your College"}].map(t=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t.id,className:"block text-sm font-medium text-slate-300 mb-1",children:t.label}),e.jsx("input",{type:t.type,id:t.id,name:t.id,placeholder:t.placeholder,value:m[t.id],onChange:U,required:!0,disabled:t.disabled,className:"w-full p-3 bg-slate-700/50 border-2 border-slate-600 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 transition disabled:bg-slate-800 disabled:text-slate-400 text-white"})]},t.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Step 3: Upload Payment Screenshot"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-600 border-dashed rounded-md",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(H,{}),e.jsxs("div",{className:"flex text-sm text-slate-400",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-slate-800 rounded-md font-medium text-purple-400 hover:text-purple-300 px-1",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",accept:"image/*",className:"sr-only",onChange:B,required:!0})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:n?n.name:"PNG, JPG, GIF up to 10MB"})]})})]}),e.jsx(y.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-semibold text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-purple-500 disabled:bg-slate-600 disabled:cursor-not-allowed transition-all transform",children:h?"Submitting...":"Submit Bundle Registration"})]})]})})})}export{$ as default};
