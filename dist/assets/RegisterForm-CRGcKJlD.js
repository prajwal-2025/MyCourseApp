import{a as R,b as T,u as Y,r as a,o as M,j as e,m as v,e as w,d as S,f as $,h as B,s as G}from"./index-BjUV0rAk.js";const q=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}),e.jsx("path",{d:"M12 12v9"}),e.jsx("path",{d:"m16 16-4-4-4 4"})]}),J=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),e.jsx("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})]}),W="drddwst2w",H="course_screenshot";function z(){const{id:n}=R(),d=T(),{showNotification:i}=Y(),[b,C]=a.useState(null),[u,P]=a.useState(null),[k,D]=a.useState(!0),[g,f]=a.useState(!1),[y,j]=a.useState(""),[h,N]=a.useState({name:"",email:"",phone:"",college:""}),[m,I]=a.useState(null),[p,U]=a.useState("full"),[x,F]=a.useState(0);a.useEffect(()=>{const t=async r=>{if(!r){localStorage.setItem("intendedPath",`/register/${n}`),d("/student-login");return}C(r),N(o=>{var l;return{...o,phone:((l=r.phoneNumber)==null?void 0:l.replace("+91",""))||""}});try{const o=w(S,"courses",n),l=await $(o);if(!l.exists()){j("Course not found."),i("Course not found.","error"),d("/");return}const c=l.data();P(c),F(c.earlyBirdPrice||c.basePrice)}catch(o){console.error("Error fetching data:",o),j("Failed to load registration details.")}finally{D(!1)}},s=sessionStorage.getItem("mockUser");if(s)t(JSON.parse(s));else{const r=M(B,t);return()=>r()}},[n,d,i]);const _=t=>{navigator.clipboard.writeText(t).then(()=>{i("UPI ID copied to clipboard!","success")})},E=t=>N({...h,[t.target.name]:t.target.value}),L=t=>I(t.target.files[0]),O=async t=>{if(t.preventDefault(),!m){i("Please upload a screenshot of your payment.","error");return}f(!0);try{const s=new FormData;s.append("file",m),s.append("upload_preset",H);const r=await fetch(`https://api.cloudinary.com/v1_1/${W}/image/upload`,{method:"POST",body:s});if(!r.ok)throw new Error("Image upload failed");const l=(await r.json()).secure_url;if(!l)throw new Error("Cloudinary did not return a URL.");const c=`${b.uid}_${n}`,A=p==="full"?x:99;await G(w(S,"registrations",c),{userId:b.uid,courseId:n,...h,screenshotUrl:l,priceOffered:x,amountPaid:A,paymentStatus:p==="full"?"full_payment_pending":"seat_lock_pending",confirmed:!1,registeredAt:new Date}),d("/confirmation")}catch(s){console.error("Error submitting form:",s),i("There was an error submitting your registration.","error")}finally{f(!1)}};return k?e.jsx("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center text-white text-lg",children:"Loading registration details..."}):y?e.jsx("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center text-red-500 font-semibold text-lg",children:y}):e.jsx("div",{className:"bg-slate-900 text-white min-h-screen font-sans pt-12 pb-12 md:pt-20 md:pb-20",children:e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-3xl mx-auto px-4",children:e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 p-6 md:p-8 rounded-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold",children:u==null?void 0:u.name}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Complete the steps below to secure your spot."})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:"Step 1: Choose Payment Option"}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-4 mt-4",children:[{type:"full",label:"Pay in Full",price:x},{type:"lock",label:"Lock Your Seat",price:99}].map(t=>e.jsxs("label",{className:`relative flex items-center p-4 rounded-lg border-2 cursor-pointer ${p===t.type?"bg-purple-500/10 border-purple-500":"bg-slate-800 border-slate-600"}`,children:[e.jsx("input",{type:"radio",name:"paymentOption",value:t.type,checked:p===t.type,onChange:s=>U(s.target.value),className:"opacity-0 absolute"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-100",children:t.label}),e.jsxs("p",{className:"text-purple-400 font-bold text-2xl",children:["â‚¹",t.price]})]})]},t.type))}),e.jsxs("div",{className:"mt-6 text-center bg-slate-900 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-slate-300",children:"Pay using UPI to the ID below:"}),e.jsxs("div",{className:"flex items-center justify-center bg-slate-700/50 p-2 rounded-md mt-2",children:[e.jsx("p",{className:"font-mono text-purple-300",children:"pathanminingacademy.62732523@hdfcbank"}),e.jsx("button",{onClick:()=>_("pathanminingacademy.62732523@hdfcbank"),className:"ml-3 text-slate-400",children:e.jsx(J,{})})]})]})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2",children:"Step 2: Fill Your Details"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[{id:"name",label:"Full Name",type:"text",placeholder:"Your Name"},{id:"email",label:"Email Address",type:"email",placeholder:"you@example.com"},{id:"phone",label:"Phone Number",type:"tel",disabled:!0},{id:"college",label:"College Name",type:"text",placeholder:"Your College"}].map(t=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t.id,className:"block text-sm font-medium text-slate-300 mb-1",children:t.label}),e.jsx("input",{type:t.type,id:t.id,name:t.id,placeholder:t.placeholder,value:h[t.id],onChange:E,required:!0,disabled:t.disabled,className:"w-full p-3 bg-slate-700/50 border-2 border-slate-600 rounded-md"})]},t.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Step 3: Upload Payment Screenshot"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-600 border-dashed rounded-md",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(q,{}),e.jsxs("div",{className:"flex text-sm text-slate-400",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-slate-800 rounded-md font-medium text-purple-400 hover:text-purple-300",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",accept:"image/*",className:"sr-only",onChange:L,required:!0})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:m?m.name:"PNG, JPG, GIF up to 10MB"})]})})]}),e.jsx(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:g,className:"w-full flex justify-center py-3 px-4 rounded-lg text-lg font-semibold text-white bg-purple-600 hover:bg-purple-700",children:g?"Submitting...":"Submit Registration"})]})]})})})}export{z as default};
